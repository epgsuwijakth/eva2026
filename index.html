<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Executive Dashboard ‚Äî ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700;800;900&family=IBM+Plex+Sans+Thai:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
:root {
  --bg-primary: #0f1117;
  --bg-card: #181b24;
  --bg-card-hover: #1e2230;
  --border: #2a2e3b;
  --text-primary: #f0f1f5;
  --text-secondary: #9ba1b0;
  --text-muted: #6b7185;
  --accent-blue: #4e8cff;
  --accent-green: #34d399;
  --accent-amber: #fbbf24;
  --accent-rose: #fb7185;
  --accent-purple: #a78bfa;
  --accent-cyan: #22d3ee;
  --shadow-card: 0 4px 24px rgba(0,0,0,0.3);
  --radius: 16px;
  --radius-sm: 10px;
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: 'Noto Sans Thai', 'IBM Plex Sans Thai', sans-serif;
  background: var(--bg-primary); color: var(--text-primary);
  min-height: 100vh; font-size: 16px; line-height: 1.6;
}
::-webkit-scrollbar { width:6px; height:6px; }
::-webkit-scrollbar-track { background:var(--bg-primary); }
::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }

/* Header */
.header {
  background: linear-gradient(180deg, #181b24 0%, var(--bg-primary) 100%);
  border-bottom: 1px solid var(--border);
  padding: 32px 48px 24px; position: sticky; top:0; z-index:100;
}
.header-top { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:24px; }
.header h1 {
  font-size:2rem; font-weight:800; letter-spacing:-0.5px;
  background:linear-gradient(135deg,#fff 0%,#9ba1b0 100%);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
}
.header .subtitle { font-size:1.05rem; color:var(--text-secondary); margin-top:4px; font-weight:400; }
.header .subtitle span.sheet-lbl { color:var(--accent-cyan); font-weight:600; }
.header-badge { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.badge {
  padding:8px 18px; border-radius:50px; font-size:0.85rem; font-weight:600;
  border:1px solid var(--border); background:var(--bg-card);
}
.badge.live { border-color:var(--accent-green); color:var(--accent-green); }
.badge.live::before { content:''; display:inline-block; width:8px; height:8px; border-radius:50%; background:var(--accent-green); margin-right:8px; animation:pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

/* Filter Bar */
.filter-bar { display:flex; gap:14px; align-items:center; flex-wrap:wrap; }
.filter-bar input, .filter-bar select {
  font-family:inherit; font-size:1rem; font-weight:500;
  padding:12px 20px; border-radius:var(--radius-sm);
  background:var(--bg-card); border:1px solid var(--border);
  color:var(--text-primary); outline:none; transition:all 0.2s;
}
.filter-bar input { min-width:280px; }
.filter-bar select { min-width:220px; cursor:pointer; }
.filter-bar input:focus, .filter-bar select:focus {
  border-color:var(--accent-blue); box-shadow:0 0 0 3px rgba(78,140,255,0.15);
}
.filter-bar input::placeholder { color:var(--text-muted); }

/* Buttons */
.btn-reset,.btn-import,.btn-clear {
  font-family:inherit; font-size:0.92rem; font-weight:600;
  padding:12px 22px; border-radius:var(--radius-sm);
  cursor:pointer; transition:all 0.25s; border:1px solid var(--border);
  display:inline-flex; align-items:center; gap:8px; white-space:nowrap;
}
.btn-reset { background:transparent; color:var(--text-secondary); }
.btn-reset:hover { border-color:var(--accent-rose); color:var(--accent-rose); }
.btn-import {
  background:linear-gradient(135deg,#4e8cff 0%,#6366f1 100%);
  color:#fff; border:none; box-shadow:0 2px 12px rgba(78,140,255,0.3);
}
.btn-import:hover { transform:translateY(-1px); box-shadow:0 4px 20px rgba(78,140,255,0.45); }
.btn-import:active { transform:translateY(0); }
.btn-import:disabled { opacity:0.5; cursor:not-allowed; transform:none; }
.btn-clear { background:transparent; color:var(--accent-amber); border-color:rgba(251,191,36,0.3); }
.btn-clear:hover { border-color:var(--accent-amber); background:rgba(251,191,36,0.08); }
#fileInput { display:none; }

/* ========== TOAST ========== */
.toast-container { position:fixed; top:24px; right:24px; z-index:9999; display:flex; flex-direction:column; gap:12px; }
.toast {
  padding:18px 48px 18px 24px; border-radius:var(--radius-sm);
  font-family:inherit; font-size:1rem; font-weight:600;
  display:flex; align-items:flex-start; gap:14px;
  min-width:380px; max-width:520px;
  box-shadow:0 8px 32px rgba(0,0,0,0.5);
  animation:toastIn 0.4s cubic-bezier(0.16,1,0.3,1) both;
  border:1px solid transparent; position:relative;
}
.toast.hiding { animation:toastOut 0.35s ease-in both; }
@keyframes toastIn { from{opacity:0;transform:translateX(60px) scale(0.95)} to{opacity:1;transform:translateX(0) scale(1)} }
@keyframes toastOut { to{opacity:0;transform:translateX(60px) scale(0.95)} }
.toast-icon { font-size:1.5rem; flex-shrink:0; line-height:1; margin-top:1px; }
.toast-body { flex:1; }
.toast-title { font-size:1rem; font-weight:700; margin-bottom:3px; }
.toast-msg { font-size:0.88rem; font-weight:400; opacity:0.85; line-height:1.5; }
.toast-close {
  position:absolute; top:12px; right:14px; background:none; border:none;
  color:inherit; opacity:0.5; cursor:pointer; font-size:1.1rem; line-height:1;
}
.toast-close:hover { opacity:1; }
.toast.success { background:#0d2818; border-color:rgba(52,211,153,0.3); color:var(--accent-green); }
.toast.error   { background:#2a0f14; border-color:rgba(251,113,133,0.3); color:var(--accent-rose); }
.toast.warning { background:#2a1f0a; border-color:rgba(251,191,36,0.3); color:var(--accent-amber); }
.toast.info    { background:#0f1a2e; border-color:rgba(78,140,255,0.3); color:var(--accent-blue); }

/* ========== IMPORT MODAL ========== */
.import-overlay {
  display:none; position:fixed; inset:0; z-index:500;
  background:rgba(0,0,0,0.6); backdrop-filter:blur(4px);
  justify-content:center; align-items:center;
}
.import-overlay.active { display:flex; }
.import-box {
  background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius);
  padding:40px 48px; max-width:560px; width:90%;
  box-shadow:0 24px 80px rgba(0,0,0,0.6); text-align:center;
  animation:modalIn 0.35s cubic-bezier(0.16,1,0.3,1) both;
}
@keyframes modalIn { from{opacity:0;transform:scale(0.92) translateY(20px)} to{opacity:1;transform:scale(1) translateY(0)} }
.import-box h2 { font-size:1.5rem; font-weight:800; margin-bottom:8px; }
.import-box p { color:var(--text-secondary); font-size:0.95rem; margin-bottom:28px; line-height:1.7; }
.drop-zone {
  border:2px dashed var(--border); border-radius:var(--radius-sm);
  padding:48px 32px; margin-bottom:24px; cursor:pointer; transition:all 0.25s;
  background:var(--bg-primary);
}
.drop-zone:hover,.drop-zone.dragover { border-color:var(--accent-blue); background:rgba(78,140,255,0.04); }
.drop-zone .dz-icon { font-size:3rem; margin-bottom:12px; }
.drop-zone .dz-text { font-size:1.05rem; color:var(--text-secondary); font-weight:600; }
.drop-zone .dz-hint { font-size:0.82rem; color:var(--text-muted); margin-top:6px; }
.drop-zone .dz-file { font-size:0.95rem; color:var(--accent-green); font-weight:700; margin-top:8px; display:none; }
.import-actions { display:flex; gap:14px; justify-content:center; }
.import-actions .btn-import { padding:14px 36px; font-size:1.05rem; }
.import-actions .btn-cancel {
  font-family:inherit; font-size:1.05rem; font-weight:600;
  padding:14px 36px; border-radius:var(--radius-sm);
  background:transparent; border:1px solid var(--border);
  color:var(--text-secondary); cursor:pointer; transition:all 0.2s;
}
.import-actions .btn-cancel:hover { border-color:var(--text-secondary); color:var(--text-primary); }
.spinner { display:none; margin:20px auto; }
.spinner.active { display:block; }
.spinner svg { animation:spin 1s linear infinite; width:40px; height:40px; }
@keyframes spin { to{transform:rotate(360deg)} }

/* ========== MAIN ========== */
.main { padding:32px 48px 64px; }

/* Empty State */
.empty-state { text-align:center; padding:100px 40px; }
.empty-state .es-icon { font-size:4rem; margin-bottom:20px; opacity:0.6; }
.empty-state h2 { font-size:1.6rem; font-weight:700; color:var(--text-secondary); margin-bottom:10px; }
.empty-state p { color:var(--text-muted); font-size:1.05rem; max-width:450px; margin:0 auto 28px; line-height:1.7; }
.empty-state .btn-import { padding:16px 40px; font-size:1.1rem; }

/* Summary */
.summary-row { display:grid; grid-template-columns:repeat(4,1fr); gap:20px; margin-bottom:36px; }
.summary-card {
  background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius);
  padding:24px 28px; position:relative; overflow:hidden; transition:all 0.3s;
}
.summary-card:hover { border-color:var(--accent-blue); transform:translateY(-2px); box-shadow:var(--shadow-card); }
.summary-card .label { font-size:0.9rem; color:var(--text-secondary); font-weight:500; margin-bottom:8px; }
.summary-card .value { font-size:2.4rem; font-weight:800; }
.summary-card .sub { font-size:0.85rem; color:var(--text-muted); margin-top:6px; }
.summary-card .icon {
  position:absolute; top:20px; right:24px; width:48px; height:48px;
  border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:1.4rem;
}
.icon-blue { background:rgba(78,140,255,0.12); color:var(--accent-blue); }
.icon-green { background:rgba(52,211,153,0.12); color:var(--accent-green); }
.icon-amber { background:rgba(251,191,36,0.12); color:var(--accent-amber); }
.icon-rose  { background:rgba(251,113,133,0.12); color:var(--accent-rose); }

/* Charts */
.charts-row { display:grid; grid-template-columns:2fr 1fr; gap:20px; margin-bottom:36px; }
.chart-card {
  background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius);
  padding:28px; transition:all 0.3s;
}
.chart-card:hover { box-shadow:var(--shadow-card); }
.chart-card h3 { font-size:1.15rem; font-weight:700; margin-bottom:20px; }

/* Position Groups */
.position-group { margin-bottom:32px; }
.position-header {
  display:flex; align-items:center; gap:14px; margin-bottom:18px;
  padding-bottom:12px; border-bottom:2px solid var(--border);
}
.position-dot { width:14px; height:14px; border-radius:50%; }
.position-header h2 { font-size:1.35rem; font-weight:700; }
.position-count {
  font-size:0.85rem; color:var(--text-muted); font-weight:500;
  background:var(--bg-card); padding:4px 14px; border-radius:50px; border:1px solid var(--border);
}

/* Person Card */
.person-card {
  background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius);
  padding:28px 32px; margin-bottom:16px; transition:all 0.3s;
  animation:fadeInUp 0.4s ease-out both;
}
.person-card:hover { border-color:var(--accent-blue); box-shadow:var(--shadow-card); transform:translateY(-1px); }
@keyframes fadeInUp { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }
.person-top { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:20px; }
.person-info h3 { font-size:1.25rem; font-weight:700; margin-bottom:4px; }
.person-info .pos-tag {
  display:inline-block; font-size:0.85rem; font-weight:600;
  padding:4px 14px; border-radius:50px;
}
.person-scores { display:flex; gap:16px; align-items:center; }
.score-pill {
  text-align:center; padding:10px 18px; border-radius:var(--radius-sm);
  background:var(--bg-primary); border:1px solid var(--border); min-width:110px;
}
.score-pill .sc-label { font-size:0.72rem; color:var(--text-muted); font-weight:600; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:4px; }
.score-pill .sc-val { font-size:1.55rem; font-weight:800; }
.score-pill.highlight { border-color:var(--accent-blue); background:rgba(78,140,255,0.06); }

.comparison-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px 28px; }
.comp-item { display:flex; align-items:center; gap:12px; }
.comp-label { font-size:0.82rem; color:var(--text-secondary); min-width:200px; font-weight:500; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.comp-bars { flex:1; display:flex; flex-direction:column; gap:3px; }
.comp-bar-row { display:flex; align-items:center; gap:8px; }
.comp-bar-tag { font-size:0.65rem; font-weight:700; min-width:22px; color:var(--text-muted); }
.comp-bar-track { flex:1; height:8px; background:var(--bg-primary); border-radius:4px; overflow:hidden; }
.comp-bar-fill { height:100%; border-radius:4px; transition:width 0.8s ease-out; }
.comp-bar-val { font-size:0.75rem; font-weight:700; min-width:32px; text-align:right; }
.bar-67   { background:var(--accent-amber); }
.bar-self { background:var(--accent-cyan); }
.bar-mgr  { background:var(--accent-purple); }

.analysis-box {
  margin-top:18px; padding:16px 22px; border-radius:var(--radius-sm);
  background:linear-gradient(135deg,rgba(78,140,255,0.04) 0%,rgba(99,102,241,0.04) 100%);
  border:1px solid rgba(78,140,255,0.1);
}
.analysis-box .analysis-title { font-size:0.82rem; font-weight:700; color:var(--accent-blue); margin-bottom:6px; text-transform:uppercase; letter-spacing:0.5px; }
.analysis-box p { font-size:0.95rem; color:var(--text-secondary); line-height:1.7; }

.trend-up { color:var(--accent-green); }
.trend-down { color:var(--accent-rose); }
.trend-same { color:var(--accent-amber); }

.legend-bar {
  display:flex; gap:24px; align-items:center; margin-bottom:24px;
  padding:14px 22px; background:var(--bg-card); border-radius:var(--radius-sm); border:1px solid var(--border);
}
.legend-item { display:flex; align-items:center; gap:8px; font-size:0.9rem; font-weight:600; color:var(--text-secondary); }
.legend-dot { width:12px; height:12px; border-radius:3px; }
.legend-dot.l67   { background:var(--accent-amber); }
.legend-dot.lself { background:var(--accent-cyan); }
.legend-dot.lmgr  { background:var(--accent-purple); }

.no-results { text-align:center; padding:80px 40px; color:var(--text-muted); font-size:1.15rem; }
.no-results .emoji { font-size:3rem; margin-bottom:16px; }

@media (max-width:1200px) {
  .summary-row { grid-template-columns:repeat(2,1fr); }
  .charts-row { grid-template-columns:1fr; }
  .comparison-grid { grid-template-columns:1fr; }
}
@media (max-width:768px) {
  .header,.main { padding-left:20px; padding-right:20px; }
  .summary-row { grid-template-columns:1fr; }
  .filter-bar { flex-direction:column; }
  .filter-bar input,.filter-bar select { min-width:100%; width:100%; }
  .person-top { flex-direction:column; gap:16px; }
  .person-scores { flex-wrap:wrap; }
  .toast { min-width:280px; max-width:92vw; }
  .import-box { padding:28px 24px; }
}
</style>
</head>
<body>

<!-- TOAST -->
<div class="toast-container" id="toastContainer"></div>

<!-- IMPORT MODAL -->
<div class="import-overlay" id="importOverlay">
  <div class="import-box">
    <h2>üìÇ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h2>
    <p>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå <strong>.xlsx</strong> ‡∏ó‡∏µ‡πà‡∏°‡∏µ 3 Sheet<br>
    <span style="color:var(--accent-amber)">‚ö†Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span></p>
    <div class="drop-zone" id="dropZone" onclick="document.getElementById('fileInput').click()">
      <div class="dz-icon">üìÑ</div>
      <div class="dz-text">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á</div>
      <div class="dz-hint">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå .xlsx ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</div>
      <div class="dz-file" id="dzFileName"></div>
    </div>
    <div class="spinner" id="importSpinner">
      <svg viewBox="0 0 50 50"><circle cx="25" cy="25" r="20" fill="none" stroke="var(--accent-blue)" stroke-width="4" stroke-dasharray="80 40" stroke-linecap="round"/></svg>
    </div>
    <div class="import-actions">
      <button class="btn-import" id="btnConfirmImport" onclick="confirmImport()" disabled>üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      <button class="btn-cancel" onclick="closeImportModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
  </div>
</div>

<!-- HEADER -->
<div class="header">
  <div class="header-top">
    <div>
      <h1>üìä Executive Performance Dashboard</h1>
      <div class="subtitle">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ ‚Äî ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö 3 ‡∏£‡∏≠‡∏ö (<span class="sheet-lbl" id="sheetNames">‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô 67 / ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡∏ô‡πÄ‡∏≠‡∏á 68 / ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô 68</span>)</div>
    </div>
    <div class="header-badge">
      <span class="badge live">Dashboard</span>
      <span class="badge" id="badgeCount">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 11 ‡∏Ñ‡∏ô</span>
    </div>
  </div>
  <div class="filter-bar">
    <input type="text" id="searchInput" placeholder="üîç  ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠..." oninput="applyFilters()">
    <select id="positionFilter" onchange="applyFilters()">
      <option value="">‡∏ó‡∏∏‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (All Positions)</option>
    </select>
    <button class="btn-reset" onclick="resetFilters()">‚úï ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
    <div style="flex:1"></div>
    <button class="btn-import" onclick="openImportModal()">üì• Import Data</button>
    <button class="btn-clear" onclick="clearDataConfirm()">üóëÔ∏è Clear Data</button>
    <input type="file" id="fileInput" accept=".xlsx" onchange="handleFileSelect(event)">
  </div>
</div>

<!-- MAIN -->
<div class="main" id="mainContent">
  <div class="summary-row" id="summaryRow"></div>
  <div class="charts-row" id="chartsRow">
    <div class="chart-card">
      <h3>üìà ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö Totals ‡∏ó‡∏±‡πâ‡∏á 3 ‡∏£‡∏≠‡∏ö ‚Äî ‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h3>
      <div><canvas id="barChart" height="110"></canvas></div>
    </div>
    <div class="chart-card">
      <h3>üè∑Ô∏è ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</h3>
      <div><canvas id="doughnutChart" height="220"></canvas></div>
    </div>
  </div>
  <div class="legend-bar" id="legendBar">
    <span style="font-weight:700;color:var(--text-primary);margin-right:8px;">‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå:</span>
    <div class="legend-item"><div class="legend-dot l67"></div> <span id="lbl1">‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô 67</span></div>
    <div class="legend-item"><div class="legend-dot lself"></div> <span id="lbl2">‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡∏ô‡πÄ‡∏≠‡∏á 68</span></div>
    <div class="legend-item"><div class="legend-dot lmgr"></div> <span id="lbl3">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô 68</span></div>
  </div>
  <div id="personContainer"></div>
</div>

<script>
// ============ STATE ============
let rawData = [];
let sheetLabels = ['‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô 67','‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡∏ô‡πÄ‡∏≠‡∏á 68','‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô 68'];
let pendingFile = null;

const criteria = ['‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô','‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÉ‡∏ô‡∏á‡∏≤‡∏ô','‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤','‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏£‡∏¥‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤','‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô','‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠-‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô','‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠-‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô','‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô','‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û'];
const colorPalette = ['#4e8cff','#a78bfa','#34d399','#fbbf24','#fb7185','#22d3ee','#f97316','#84cc16','#ec4899','#14b8a6'];
let posColors = {};

function assignColors() {
  const pos = [...new Set(rawData.map(d=>d.position))];
  posColors = {}; pos.forEach((p,i) => posColors[p] = colorPalette[i % colorPalette.length]);
}

// ============ DEFAULT DATA ============
const defaultData = [
  {no:1,name:'‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏†‡∏≤‡∏ì‡∏∏‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏™‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏á (‡πÅ‡∏ô‡∏ô)',position:'Sr. Product Development',eval67:{scores:[4,3.5,3.5,3.5,3.5,4,3.5,4,3.5,3.5],scoreWork:3.60,scorePerson:3.68,total:3.62},self68:{scores:[4,3,3,3,2,4,4,4,3,3],scoreWork:3.00,scorePerson:3.50,total:3.15},mgr68:{scores:[4,4,3.5,3.5,3.5,4,4,4,3,3.5],scoreWork:3.70,scorePerson:3.63,total:3.68}},
  {no:2,name:'‡∏ô‡∏≤‡∏¢‡∏û‡∏™‡∏¥‡∏©‡∏ê‡πå ‡∏ô‡∏¥‡∏¢‡∏°‡∏ó‡∏≠‡∏á (‡∏û‡∏•‡∏∏)',position:'Product Manager',eval67:{scores:[null,null,null,null,null,null,null,null,null,null],scoreWork:0,scorePerson:0,total:0},self68:{scores:[3,4,3,4,5,4,5,5,4,4],scoreWork:3.80,scorePerson:4.25,total:3.94},mgr68:{scores:[3,3.5,3,3.5,4,3.5,3.5,3.5,3.5,4],scoreWork:3.40,scorePerson:3.63,total:3.47}},
  {no:3,name:'‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏±‡∏ç‡∏ç‡∏≤‡∏û‡∏±‡∏ä‡∏£ ‡∏ò‡∏¥‡∏™‡∏≤‡∏£ (‡∏≠‡∏±‡∏¢‡∏¢‡πå)',position:'Business Analyst',eval67:{scores:[4,4,5,4,4,4,4,4,4,4],scoreWork:4.20,scorePerson:4.00,total:4.14},self68:{scores:[4,5,5,5,4,5,5,5,5,4],scoreWork:4.60,scorePerson:4.75,total:4.65},mgr68:{scores:[4,4,5,4.5,4,4.5,4.5,4.5,4.5,4],scoreWork:4.30,scorePerson:4.38,total:4.32}},
  {no:4,name:'‡∏ó‡∏®‡∏û‡∏• ‡∏Ñ‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç (‡πÄ‡∏ö‡∏Ñ)',position:'Business Analyst',eval67:{scores:[null,null,null,null,null,null,null,null,null,null],scoreWork:0,scorePerson:0,total:0},self68:{scores:[4,4,4,4,4,4,4,4,4,5],scoreWork:4.00,scorePerson:4.25,total:4.07},mgr68:{scores:[3.25,3.5,3.5,3.5,4,3.5,3.5,3.5,3.5,3.5],scoreWork:3.55,scorePerson:3.50,total:3.54}},
  {no:5,name:'‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ì‡∏±‡∏ê‡∏ô‡∏±‡∏ô‡∏ó‡πå ‡∏Å‡∏°‡∏•‡∏´‡∏±‡∏ï‡∏ñ‡πå (‡∏ô‡πâ‡∏≠‡∏¢)',position:'Senior Project Coordinator',eval67:{scores:[null,null,null,null,null,null,null,null,null,null],scoreWork:0,scorePerson:0,total:0},self68:{scores:[3,4,5,5,5,5,5,5,5,3],scoreWork:4.40,scorePerson:4.50,total:4.43},mgr68:{scores:[3.5,4,4,4,4,4,4,4,4,4],scoreWork:3.90,scorePerson:4.00,total:3.93}},
  {no:6,name:'‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ì‡∏†‡∏±‡∏ó‡∏£‡∏ä‡∏≤‡∏ô‡∏±‡∏ô‡∏ó‡πå ‡∏™‡∏∏‡∏ô‡∏ó‡∏£‡∏ò‡∏ô‡∏ß‡∏±‡∏à‡∏ô‡πå (‡πÄ‡∏Å‡πã)',position:'QA',eval67:{scores:[4,4,4,3.8,4,4,4,4,4,3.5],scoreWork:3.96,scorePerson:3.88,total:3.93},self68:{scores:[3,3,3,3,3,3,3,3,4,3],scoreWork:3.00,scorePerson:3.25,total:3.08},mgr68:{scores:[3,3,3,3,3,3,3,3,4,3],scoreWork:3.00,scorePerson:3.25,total:3.08}},
  {no:7,name:'‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡πÅ‡∏û‡∏£‡∏û‡∏¥‡πÑ‡∏• ‡∏û‡∏¥‡∏®‡∏≤‡∏•‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå (‡∏≠‡∏¥‡πã‡∏°)',position:'QA',eval67:{scores:[3,3.5,4,3.5,3,4,4,5,4,3],scoreWork:3.40,scorePerson:3.85,total:3.54},self68:{scores:[3,3,3,3,4,4,4,5,5,4],scoreWork:3.20,scorePerson:4.35,total:3.55},mgr68:{scores:[3,3,3,3,4,4,4,5,5,4],scoreWork:3.20,scorePerson:4.35,total:3.55}},
  {no:8,name:'‡∏ô‡∏≤‡∏¢‡∏õ‡∏¥‡∏¢‡∏∞‡∏û‡∏• ‡∏ó‡∏¥‡∏ô‡∏Å‡∏£ (‡πÇ‡∏ü‡∏Å‡∏±‡∏™)',position:'QA',eval67:{scores:[3.5,4,4,3,3,3.5,4,4,3,3],scoreWork:3.50,scorePerson:3.38,total:3.46},self68:{scores:[3,5,5,4,3,5,4,5,3,3],scoreWork:4.00,scorePerson:3.85,total:3.96},mgr68:{scores:[3,5,5,4,3,5,4,5,3,3],scoreWork:4.00,scorePerson:3.85,total:3.96}},
  {no:9,name:'‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏™‡∏∏‡∏Ç‡πÉ‡∏™ (‡πÄ‡∏≠‡∏°)',position:'QA',eval67:{scores:[3,4,4,4,3,4,3,3,3,3],scoreWork:3.60,scorePerson:3.25,total:3.50},self68:{scores:[3,4,3,4,3,4,3,4,3,3],scoreWork:3.40,scorePerson:3.35,total:3.39},mgr68:{scores:[3,4,3,4,3,4,3,4,3,3],scoreWork:3.40,scorePerson:3.35,total:3.39}},
  {no:10,name:'‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏°‡∏•‡∏ß‡∏£‡∏£‡∏ì ‡∏û‡∏•‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì (‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà)',position:'Application Management',eval67:{scores:[3,4,4,3.5,3,3.5,4,4,3,3],scoreWork:3.50,scorePerson:3.38,total:3.46},self68:{scores:[3,5,5,3,3,5,4,5,3,3],scoreWork:3.80,scorePerson:3.85,total:3.82},mgr68:{scores:[3,5,5,3,3,5,4,5,3,3],scoreWork:3.80,scorePerson:3.85,total:3.82}},
  {no:11,name:'‡∏ô‡∏≤‡∏¢‡∏®‡∏∏‡∏†‡∏Å‡∏£ ‡πÄ‡∏Å‡∏©‡∏ä‡∏∏‡∏°‡∏û‡∏• (‡πÑ‡∏≠‡∏ã‡πå)',position:'Application Management',eval67:{scores:[3,4,4,3,3,4,3.5,4,3,3],scoreWork:3.40,scorePerson:3.43,total:3.41},self68:{scores:[3,5,5,4,3,4,3,3,4,3],scoreWork:4.00,scorePerson:3.50,total:3.85},mgr68:{scores:[3,5,5,4,3,4,3,3,4,3],scoreWork:4.00,scorePerson:3.50,total:3.85}}
];

// ============ TOAST ============
function showToast(type, title, msg, duration=5000) {
  const c = document.getElementById('toastContainer');
  const icons = {success:'‚úÖ',error:'‚ùå',warning:'‚ö†Ô∏è',info:'‚ÑπÔ∏è'};
  const t = document.createElement('div');
  t.className = `toast ${type}`;
  t.innerHTML = `<div class="toast-icon">${icons[type]||'‚ÑπÔ∏è'}</div><div class="toast-body"><div class="toast-title">${title}</div><div class="toast-msg">${msg}</div></div><button class="toast-close" onclick="this.parentElement.classList.add('hiding');setTimeout(()=>this.parentElement.remove(),350)">‚úï</button>`;
  c.appendChild(t);
  setTimeout(()=>{t.classList.add('hiding');setTimeout(()=>t.remove(),350);},duration);
}

// ============ IMPORT MODAL ============
function openImportModal() {
  pendingFile = null;
  document.getElementById('fileInput').value = '';
  document.getElementById('dzFileName').style.display = 'none';
  document.getElementById('btnConfirmImport').disabled = true;
  document.getElementById('importSpinner').classList.remove('active');
  document.getElementById('importOverlay').classList.add('active');
}
function closeImportModal() {
  document.getElementById('importOverlay').classList.remove('active');
  pendingFile = null;
}

// Drop zone
const dropZone = document.getElementById('dropZone');
dropZone.addEventListener('dragover', e=>{e.preventDefault(); dropZone.classList.add('dragover');});
dropZone.addEventListener('dragleave', ()=>dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', e=>{
  e.preventDefault(); dropZone.classList.remove('dragover');
  if(e.dataTransfer.files.length>0) processSelectedFile(e.dataTransfer.files[0]);
});

function handleFileSelect(e) { if(e.target.files.length>0) processSelectedFile(e.target.files[0]); }

function processSelectedFile(file) {
  const name = file.name.toLowerCase();
  if (!name.endsWith('.xlsx')) {
    showToast('error','‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',`‡πÑ‡∏ü‡∏•‡πå "<strong>${file.name}</strong>" ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• .xlsx<br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel (.xlsx) ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô`,6000);
    pendingFile = null;
    document.getElementById('dzFileName').style.display = 'none';
    document.getElementById('btnConfirmImport').disabled = true;
    return;
  }
  pendingFile = file;
  const el = document.getElementById('dzFileName');
  el.textContent = `üìé ${file.name} (${(file.size/1024).toFixed(1)} KB)`;
  el.style.display = 'block';
  document.getElementById('btnConfirmImport').disabled = false;
  showToast('info','‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß',`‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤: ${file.name}`);
}

function confirmImport() {
  if (!pendingFile) return;
  const spinner = document.getElementById('importSpinner');
  const btn = document.getElementById('btnConfirmImport');
  spinner.classList.add('active');
  btn.disabled = true; btn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...';

  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const wb = XLSX.read(new Uint8Array(e.target.result), {type:'array'});
      if (wb.SheetNames.length < 3) throw new Error(`‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏µ‡πÄ‡∏û‡∏µ‡∏¢‡∏á ${wb.SheetNames.length} Sheet ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 3 Sheet`);

      const s1 = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {defval:null});
      const s2 = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[1]], {defval:null});
      const s3 = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[2]], {defval:null});
      sheetLabels = [wb.SheetNames[0], wb.SheetNames[1], wb.SheetNames[2]];

      const allNames = [...new Set([...s1.map(r=>r['Name']),...s2.map(r=>r['Name']),...s3.map(r=>r['Name'])])].filter(Boolean);

      rawData = allNames.map((nm,i) => {
        const r1 = s1.find(r=>r['Name']===nm) || {};
        const r2 = s2.find(r=>r['Name']===nm) || {};
        const r3 = s3.find(r=>r['Name']===nm) || {};
        const base = r2['Name'] ? r2 : (r1['Name'] ? r1 : r3);
        return {
          no:i+1, name:nm,
          position: base['Position'] || r1['Position'] || r3['Position'] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏',
          eval67: parseRow(r1), self68: parseRow(r2), mgr68: parseRow(r3)
        };
      });

      const importedName = pendingFile.name;
      assignColors(); updateUI(); rebuildFilter(); applyFilters();
      closeImportModal();
      showToast('success','‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',`‡πÇ‡∏´‡∏•‡∏î ${rawData.length} ‡∏Ñ‡∏ô ‡∏à‡∏≤‡∏Å ${importedName}<br>Sheets: ${sheetLabels.join(', ')}`,6000);
    } catch(err) {
      showToast('error','‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',err.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ',7000);
    } finally {
      spinner.classList.remove('active');
      btn.disabled = false; btn.textContent = 'üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
    }
  };
  reader.readAsArrayBuffer(pendingFile);
}

function parseRow(row) {
  if (!row || !row['Name']) return {scores:[null,null,null,null,null,null,null,null,null,null],scoreWork:0,scorePerson:0,total:0};
  const skip = new Set(['No','Name','Position','Score ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô','Score ‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•','Totals','‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô']);
  const keys = Object.keys(row).filter(k=>!skip.has(k.trim()));
  const scores = keys.slice(0,10).map(k=>{const v=row[k]; return v!=null&&v!==''?parseFloat(v)||null:null;});
  while(scores.length<10) scores.push(null);
  return {scores, scoreWork:parseFloat(row['Score ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô'])||0, scorePerson:parseFloat(row['Score ‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•'])||0, total:parseFloat(row['Totals'])||0};
}

// ============ CLEAR DATA ============
function clearDataConfirm() {
  if (rawData.length===0) { showToast('warning','‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•','‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Import Data ‡∏Å‡πà‡∏≠‡∏ô'); return; }
  if (confirm('‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á')) {
    rawData = []; assignColors(); updateUI(); rebuildFilter(); renderEmpty();
    showToast('success','‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß','‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Import Data ‡πÉ‡∏´‡∏°‡πà');
  }
}
function renderEmpty() {
  document.getElementById('summaryRow').innerHTML = '';
  document.getElementById('chartsRow').style.display = 'none';
  document.getElementById('legendBar').style.display = 'none';
  document.getElementById('personContainer').innerHTML = `
    <div class="empty-state">
      <div class="es-icon">üìÇ</div>
      <h2>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h2>
      <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå Excel (.xlsx) ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Dashboard</p>
      <button class="btn-import" onclick="openImportModal()">üì• Import Data</button>
    </div>`;
}

// ============ UI HELPERS ============
function updateUI() {
  document.getElementById('badgeCount').textContent = rawData.length > 0 ? `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${rawData.length} ‡∏Ñ‡∏ô` : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
  document.getElementById('sheetNames').textContent = sheetLabels.join(' / ');
  document.getElementById('lbl1').textContent = sheetLabels[0];
  document.getElementById('lbl2').textContent = sheetLabels[1];
  document.getElementById('lbl3').textContent = sheetLabels[2];
}
function rebuildFilter() {
  const sel = document.getElementById('positionFilter');
  sel.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (All Positions)</option>';
  [...new Set(rawData.map(d=>d.position))].forEach(p=>{
    const o = document.createElement('option'); o.value=p; o.textContent=p; sel.appendChild(o);
  });
}

// ============ UTILITIES ============
function fmt(v){return v!=null&&v!==0?v.toFixed(2):'‚Äî';}
function fmtS(v){return v!=null&&v!==0?v.toFixed(1):'‚Äî';}
function getTrend(o,c){
  if(!o||o===0) return {icon:'üÜï',cls:'trend-same',text:'‡πÉ‡∏´‡∏°‡πà'};
  const d=c-o;
  if(d>0.05) return {icon:'‚ñ≤',cls:'trend-up',text:`+${d.toFixed(2)}`};
  if(d<-0.05) return {icon:'‚ñº',cls:'trend-down',text:`${d.toFixed(2)}`};
  return {icon:'‚Äî',cls:'trend-same',text:'‡∏Ñ‡∏á‡∏ó‡∏µ‡πà'};
}
function getGrade(t){
  if(t>=4.5) return {grade:'‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°',color:'#34d399'};
  if(t>=4.0) return {grade:'‡∏î‡∏µ‡∏°‡∏≤‡∏Å',color:'#4e8cff'};
  if(t>=3.5) return {grade:'‡∏î‡∏µ',color:'#a78bfa'};
  if(t>=3.0) return {grade:'‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á',color:'#fbbf24'};
  if(t>0) return {grade:'‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á',color:'#fb7185'};
  return {grade:'‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',color:'#6b7185'};
}
function analyze(p){
  const sTotal=p.self68.total, mTotal=p.mgr68.total, eTotal=p.eval67.total;
  const mSc=p.mgr68.scores, sSc=p.self68.scores, eSc=p.eval67.scores;
  let r=[];

  // ‚îÄ‚îÄ 1) Overall grade ‚îÄ‚îÄ
  const g=getGrade(mTotal);
  r.push(`‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏î‡∏¢${sheetLabels[2]}: <strong style="color:${g.color}">${fmt(mTotal)} (${g.grade})</strong>`);

  // ‚îÄ‚îÄ 2) Self vs Manager total ‚îÄ‚îÄ
  if(sTotal>0 && mTotal>0){
    const gap=sTotal-mTotal;
    if(gap>0.3) r.push(`‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤ ${gap.toFixed(2)} ‚Äî ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á`);
    else if(gap<-0.3) r.push(`‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏ô‡πÄ‡∏≠‡∏á ${Math.abs(gap).toFixed(2)} ‚Äî ‡∏°‡∏µ‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡∏ô‡πÄ‡∏≠‡∏á`);
    else r.push(`‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô (‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô ${Math.abs(gap).toFixed(2)})`);
  }

  // ‚îÄ‚îÄ 3) YoY total trend ‚îÄ‚îÄ
  if(eTotal>0 && mTotal>0){
    const y=mTotal-eTotal;
    if(y>0.1) r.push(`üìà ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å ${sheetLabels[0]} (+${y.toFixed(2)})`);
    else if(y<-0.1) r.push(`üìâ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏•‡∏î‡∏à‡∏≤‡∏Å ${sheetLabels[0]} (${y.toFixed(2)})`);
    else r.push(`‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö ${sheetLabels[0]}`);
  } else if(eTotal===0) r.push(`‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${sheetLabels[0]}`);

  // ‚îÄ‚îÄ 4) Data quality check: detect identical sheets ‚îÄ‚îÄ
  const hasM = mSc.some(v=>v!=null);
  const hasS = sSc.some(v=>v!=null);
  const hasE = eSc.some(v=>v!=null);
  
  let selfMgrIdentical = false;
  if(hasM && hasS){
    selfMgrIdentical = mSc.every((v,i) => v === sSc[i]);
    if(selfMgrIdentical){
      r.push(`<span style="color:var(--accent-amber)">‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${sheetLabels[1]} ‡∏Å‡∏±‡∏ö ${sheetLabels[2]} <strong>‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</strong> ‚Äî ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>`);
    }
  }

  // ‚îÄ‚îÄ 5) Cross-Sheet Strength & Weakness (Average of all available rounds) ‚îÄ‚îÄ
  if(hasM){
    // Build per-criteria average across available rounds
    const perCriteria = [];
    for(let i=0; i<10; i++){
      const vals = [];
      if(mSc[i]!=null) vals.push({src:'mgr', v:mSc[i]});
      if(sSc[i]!=null) vals.push({src:'self', v:sSc[i]});
      if(eSc[i]!=null) vals.push({src:'e67', v:eSc[i]});
      if(vals.length===0) continue;
      
      const avg = vals.reduce((s,x)=>s+x.v,0)/vals.length;
      const mgrVal = mSc[i];
      const selfVal = sSc[i];
      const e67Val = eSc[i];
      const name = criteria[i] || ('‡∏´‡∏°‡∏ß‡∏î '+(i+1));
      
      // Consensus: how many rounds agree it's high (>=4) or low (<=3)
      const highCount = vals.filter(x=>x.v>=4).length;
      const lowCount = vals.filter(x=>x.v<=3).length;
      
      perCriteria.push({i, name, avg, mgrVal, selfVal, e67Val, vals, highCount, lowCount, rounds:vals.length});
    }
    
    if(perCriteria.length > 0){
      // Sort by average desc for strengths, asc for weaknesses
      const sorted = [...perCriteria].sort((a,b)=>b.avg-a.avg);
      const maxAvg = sorted[0].avg;
      const minAvg = sorted[sorted.length-1].avg;
      
      if(maxAvg !== minAvg){
        // Strengths: top tier (within 0.3 of max average)
        const strengthItems = sorted.filter(c=>c.avg >= maxAvg - 0.3);
        // Weaknesses: bottom tier (within 0.3 of min average)
        const weakItems = sorted.filter(c=>c.avg <= minAvg + 0.3);
        
        // Format with consensus indicator
        const fmtStrength = strengthItems.map(c=>{
          const consensus = c.highCount === c.rounds ? ' ‚úì' : '';
          return `${c.name} (${c.avg.toFixed(1)}${consensus})`;
        });
        const fmtWeak = weakItems.map(c=>{
          const consensus = c.lowCount === c.rounds ? ' ‚úó' : '';
          return `${c.name} (${c.avg.toFixed(1)}${consensus})`;
        });
        
        r.push(`üí™ ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á (‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î): ${fmtStrength.join(', ')}`);
        r.push(`üîß ‡∏Ñ‡∏ß‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ (‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î): ${fmtWeak.join(', ')}`);
      } else {
        r.push(`‚ÑπÔ∏è ‡∏ó‡∏∏‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô (${maxAvg.toFixed(1)}) ‚Äî ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠`);
      }
      
      // ‚îÄ‚îÄ 6) Gap Analysis per-criteria (only if sheets differ) ‚îÄ‚îÄ
      if(!selfMgrIdentical && hasS){
        const gaps = perCriteria
          .filter(c=>c.mgrVal!=null && c.selfVal!=null)
          .map(c=>({...c, gap: c.selfVal - c.mgrVal}))
          .filter(c=>Math.abs(c.gap) >= 0.5)
          .sort((a,b)=>Math.abs(b.gap)-Math.abs(a.gap));
        
        if(gaps.length > 0){
          const overList = gaps.filter(g=>g.gap>0).slice(0,3);
          const underList = gaps.filter(g=>g.gap<0).slice(0,3);
          let gapParts = [];
          if(overList.length>0){
            gapParts.push(`‚ö° ‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤: ${overList.map(g=>`${g.name} (+${g.gap.toFixed(1)})`).join(', ')}`);
          }
          if(underList.length>0){
            gapParts.push(`üéØ ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏ô‡πÄ‡∏≠‡∏á: ${underList.map(g=>`${g.name} (${g.gap.toFixed(1)})`).join(', ')}`);
          }
          if(gapParts.length>0) r.push(gapParts.join('<br>'));
        }
      }
      
      // ‚îÄ‚îÄ 7) YoY per-criteria movement (only if eval67 exists) ‚îÄ‚îÄ
      if(hasE){
        const yoy = perCriteria
          .filter(c=>c.mgrVal!=null && c.e67Val!=null)
          .map(c=>({...c, diff: c.mgrVal - c.e67Val}))
          .filter(c=>Math.abs(c.diff) >= 0.5)
          .sort((a,b)=>Math.abs(b.diff)-Math.abs(a.diff));
        
        if(yoy.length>0){
          const improved = yoy.filter(y=>y.diff>0).slice(0,3);
          const declined = yoy.filter(y=>y.diff<0).slice(0,3);
          let yoyParts = [];
          if(improved.length>0){
            yoyParts.push(`üöÄ ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏õ‡∏µ‡∏Å‡πà‡∏≠‡∏ô: ${improved.map(y=>`${y.name} (+${y.diff.toFixed(1)})`).join(', ')}`);
          }
          if(declined.length>0){
            yoyParts.push(`‚ö†Ô∏è ‡∏•‡∏î‡∏•‡∏á‡∏à‡∏≤‡∏Å‡∏õ‡∏µ‡∏Å‡πà‡∏≠‡∏ô: ${declined.map(y=>`${y.name} (${y.diff.toFixed(1)})`).join(', ')}`);
          }
          if(yoyParts.length>0) r.push(yoyParts.join('<br>'));
        }
      }
    }
  }

  return r.join('<br>');
}

// ============ RENDER ============
function renderSummary(data){
  const c=document.getElementById('summaryRow');
  if(!data.length){c.innerHTML='';return;}
  const pc=[...new Set(data.map(d=>d.position))].length;
  const wM=data.filter(d=>d.mgr68.total>0), wS=data.filter(d=>d.self68.total>0);
  const aM=wM.length?wM.reduce((s,d)=>s+d.mgr68.total,0)/wM.length:0;
  const aS=wS.length?wS.reduce((s,d)=>s+d.self68.total,0)/wS.length:0;
  const top=[...data].filter(d=>d.mgr68.total>0).sort((a,b)=>b.mgr68.total-a.mgr68.total)[0];
  c.innerHTML=`
    <div class="summary-card"><div class="label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</div><div class="value">${data.length}</div><div class="sub">${pc} ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</div><div class="icon icon-blue">üë•</div></div>
    <div class="summary-card"><div class="label">‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (${sheetLabels[2]})</div><div class="value" style="color:var(--accent-green)">${aM.toFixed(2)}</div><div class="sub">${getGrade(aM).grade}</div><div class="icon icon-green">üìä</div></div>
    <div class="summary-card"><div class="label">‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (${sheetLabels[1]})</div><div class="value" style="color:var(--accent-cyan)">${aS.toFixed(2)}</div><div class="sub">Gap: ${(aS-aM).toFixed(2)}</div><div class="icon icon-amber">üìù</div></div>
    <div class="summary-card"><div class="label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (${sheetLabels[2]})</div><div class="value" style="color:var(--accent-purple)">${top?fmt(top.mgr68.total):'‚Äî'}</div><div class="sub">${top?top.name.match(/\(([^)]+)\)/)?.[1]||top.name:'‚Äî'}</div><div class="icon icon-rose">üèÜ</div></div>`;
}

let barC=null, doughC=null;
function renderCharts(data){
  document.getElementById('chartsRow').style.display = data.length?'grid':'none';
  document.getElementById('legendBar').style.display = data.length?'flex':'none';
  if(!data.length) return;
  const sorted=[...data].sort((a,b)=>b.mgr68.total-a.mgr68.total);
  const labels=sorted.map(d=>{const m=d.name.match(/\(([^)]+)\)/);return m?m[1]:d.name.substring(0,10);});
  const ctx1=document.getElementById('barChart').getContext('2d');
  if(barC) barC.destroy();
  Chart.register(ChartDataLabels);
  barC=new Chart(ctx1,{type:'bar',data:{labels,datasets:[
    {label:sheetLabels[0],data:sorted.map(d=>d.eval67.total||null),backgroundColor:'rgba(251,191,36,0.7)',borderColor:'#fbbf24',borderWidth:1,borderRadius:4},
    {label:sheetLabels[1],data:sorted.map(d=>d.self68.total||null),backgroundColor:'rgba(34,211,238,0.7)',borderColor:'#22d3ee',borderWidth:1,borderRadius:4},
    {label:sheetLabels[2],data:sorted.map(d=>d.mgr68.total||null),backgroundColor:'rgba(167,139,250,0.7)',borderColor:'#a78bfa',borderWidth:1,borderRadius:4}
  ]},options:{responsive:true,layout:{padding:{top:30}},plugins:{legend:{labels:{color:'#9ba1b0',font:{family:'Noto Sans Thai',size:13,weight:'600'},padding:20}},datalabels:{anchor:'end',align:'end',offset:2,rotation:-90,color:ctx=>['#fbbf24','#22d3ee','#a78bfa'][ctx.datasetIndex]||'#9ba1b0',font:{family:'Noto Sans Thai',size:11,weight:'700'},formatter:v=>(v===null||v===0)?'':v.toFixed(2),padding:{bottom:2}}},scales:{x:{ticks:{color:'#9ba1b0',font:{family:'Noto Sans Thai',size:13,weight:'600'}},grid:{color:'rgba(42,46,59,0.5)'}},y:{min:0,max:5.5,ticks:{color:'#9ba1b0',stepSize:1,font:{size:13}},grid:{color:'rgba(42,46,59,0.5)'}}}}});

  const pc={};data.forEach(d=>{pc[d.position]=(pc[d.position]||0)+1;});
  const ctx2=document.getElementById('doughnutChart').getContext('2d');
  if(doughC) doughC.destroy();
  doughC=new Chart(ctx2,{type:'doughnut',data:{labels:Object.keys(pc),datasets:[{data:Object.values(pc),backgroundColor:Object.keys(pc).map(p=>posColors[p]||'#6b7185'),borderColor:'#181b24',borderWidth:3}]},options:{responsive:true,cutout:'60%',plugins:{datalabels:{display:false},legend:{position:'bottom',labels:{color:'#9ba1b0',font:{family:'Noto Sans Thai',size:12,weight:'600'},padding:14}}}}});
}

function renderCards(data){
  const c=document.getElementById('personContainer');
  if(!data.length&&!rawData.length){renderEmpty();return;}
  if(!data.length){c.innerHTML='<div class="no-results"><div class="emoji">üîç</div>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</div>';return;}
  const groups={};data.forEach(d=>{if(!groups[d.position])groups[d.position]=[];groups[d.position].push(d);});
  Object.values(groups).forEach(g=>g.sort((a,b)=>b.mgr68.total-a.mgr68.total));
  const sPos=Object.keys(groups).sort((a,b)=>{
    const aA=groups[a].reduce((s,d)=>s+d.mgr68.total,0)/groups[a].length;
    const aB=groups[b].reduce((s,d)=>s+d.mgr68.total,0)/groups[b].length;
    return aB-aA;
  });
  let h='';
  sPos.forEach((pos,pi)=>{
    const ppl=groups[pos], col=posColors[pos]||'#6b7185';
    h+=`<div class="position-group"><div class="position-header"><div class="position-dot" style="background:${col}"></div><h2>${pos}</h2><span class="position-count">${ppl.length} ‡∏Ñ‡∏ô</span></div>`;
    ppl.forEach((p,idx)=>{
      const tr=getTrend(p.eval67.total,p.mgr68.total);
      h+=`<div class="person-card" style="animation-delay:${(pi*3+idx)*0.06}s">
        <div class="person-top"><div class="person-info"><h3>${p.name}</h3><span class="pos-tag" style="background:${col}15;color:${col};border:1px solid ${col}33">${p.position}</span></div>
        <div class="person-scores">
          <div class="score-pill"><div class="sc-label">${sheetLabels[0]}</div><div class="sc-val" style="color:var(--accent-amber)">${fmt(p.eval67.total)}</div></div>
          <div class="score-pill"><div class="sc-label">${sheetLabels[1]}</div><div class="sc-val" style="color:var(--accent-cyan)">${fmt(p.self68.total)}</div></div>
          <div class="score-pill highlight"><div class="sc-label">${sheetLabels[2]}</div><div class="sc-val" style="color:var(--accent-purple)">${fmt(p.mgr68.total)}</div></div>
          <div class="score-pill"><div class="sc-label">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°</div><div class="sc-val ${tr.cls}" style="font-size:1.1rem">${tr.icon} ${tr.text}</div></div>
        </div></div>
        <div class="comparison-grid">${criteria.map((cr,i)=>{
          const v1=p.eval67.scores[i],v2=p.self68.scores[i],v3=p.mgr68.scores[i];
          return `<div class="comp-item"><div class="comp-label">${cr}</div><div class="comp-bars">
            <div class="comp-bar-row"><span class="comp-bar-tag">67</span><div class="comp-bar-track"><div class="comp-bar-fill bar-67" style="width:${v1?v1/5*100:0}%"></div></div><span class="comp-bar-val" style="color:var(--accent-amber)">${v1!=null?fmtS(v1):'‚Äî'}</span></div>
            <div class="comp-bar-row"><span class="comp-bar-tag">‡∏ï‡∏ô</span><div class="comp-bar-track"><div class="comp-bar-fill bar-self" style="width:${v2?v2/5*100:0}%"></div></div><span class="comp-bar-val" style="color:var(--accent-cyan)">${v2!=null?fmtS(v2):'‚Äî'}</span></div>
            <div class="comp-bar-row"><span class="comp-bar-tag">‡∏´‡∏ô.</span><div class="comp-bar-track"><div class="comp-bar-fill bar-mgr" style="width:${v3?v3/5*100:0}%"></div></div><span class="comp-bar-val" style="color:var(--accent-purple)">${v3!=null?fmtS(v3):'‚Äî'}</span></div>
          </div></div>`;}).join('')}</div>
        <div class="analysis-box"><div class="analysis-title">üîé ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏£‡∏∏‡∏õ</div><p>${analyze(p)}</p></div>
      </div>`;
    });
    h+='</div>';
  });
  c.innerHTML=h;
}

// ============ FILTER ============
function applyFilters(){
  const s=document.getElementById('searchInput').value.trim().toLowerCase();
  const p=document.getElementById('positionFilter').value;
  let f=rawData;
  if(s) f=f.filter(d=>d.name.toLowerCase().includes(s));
  if(p) f=f.filter(d=>d.position===p);
  renderSummary(f); renderCharts(f); renderCards(f);
}
function resetFilters(){
  document.getElementById('searchInput').value='';
  document.getElementById('positionFilter').value='';
  applyFilters();
}

// ============ INIT ============
rawData=[...defaultData];
assignColors(); updateUI(); rebuildFilter(); applyFilters();
</script>
</body>
</html>
